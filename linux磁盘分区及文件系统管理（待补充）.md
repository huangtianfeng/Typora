[TOC]

# 文件系统及相关概念介绍

## 相关概念介绍

### 文件系统格式

操作系统中，根据不同的存储形式，文件系统格式有很多分类！

linux中，最常见的格式有ext系列（2,3,4），xfs，9660以及最新的btrfs文件系统

创建文件系统，便是我们常说的格式化。 格式化分为两种，低级格式化和高级格式化，低级格式化指在对磁盘分区前，进行磁道的划分、 高级格式化，是在分区之后，为分区创建文件系统，也就是本章节要重点介绍的内容。

所谓的创建文件系统，首先将分区划分为两个部分，一个称之为元数据区，在其中划分出inode，用来存放文件的元数据，还有一个称之为数据区，数据区中，也会划分出block，用以存放文件数据

![文件系统构成](F:\Users\tian\Pictures\linux图库\文件系统构成.png)

对于较大的磁盘，系统会将其划分成多个块组，每个块组都有独立的元数据区和数据区， 为了便于管理，还要有一个超级块，用来存放每个块组的位置等相关信息

### 元数据

每个文件都有一组元数据，所谓的元数据，我将其理解为一个文件的索引，目录， 它包含了对应文件的文件大小，文件类型，属主，属组，权限，数据块指针以及三个时间戳，最近访问时间（access time），最近改动时间（change time）和最近更改时间（modification time）等内容！

其中modification time，表示最近更改文件内容的时间

change time 表示的则是最近更改元数据的时间，该时间不允许手动修改，它会随着创建链接，手动修改时间戳，修改文件等操作一同更新

**inode**

用来存储元数据的固定数据结构，一般来说，在创建文件系统的时候，就将其数量固定（这意味着，一个文件系统的文件数量也有最大限制，即使空间还有容量，也无法存储文件），用的时候，只需要向该节点中填充对应数据即可，其中，数据块指针存储位置的大小，决定了单个文件的最大上限

众多inode组成inode表，每个inode都有编号，而位图索引，由二进制数组成，每个数标识着对应的inode是否空闲

**综上所述，一个文件在文件系统中，由inode和数据块两部分组成**

**元数据查看，可以使用stat命令，后跟文件名即可**

### 目录

目录是一个特殊的文件，一个数据块，其中存放着文件和inode之间的对应关系（注意，文件名是存放在目录中的，不是元数据）

我们通常找一个文件的过程大概是这样的，列入，我们找/etc/passwd 文件，我们从根目录开始，首先找到/etc目录，在该数据块中找到passwd文件名所对应到的inode号，而后去找这个inode，最后根据这个inode中的数据块指针，找到passwd文件存放的真正位置，说起来可能有点绕，上图

![文件查找](F:\Users\tian\Pictures\linux图库\文件查找.png)

注意，根目录下是存放有其下各目录和inode号的对应关系的，所以从根目录便可直接找到etc目录的inode！

### 软链接和硬连接

有了上面的概念，软链接和硬连接就很好理解了，所谓的软链接其实就是在某个目录下创建一个文件名和inode的映射关系，将其关联到你想指向的文件的inode上面

而硬连接，是创建一个新的inode，它和你想指向的文件，指向同一个数据块

说起来又有点绕了，老规矩，以passwd文件为例，建它的软链接和硬连接，上图

![软链接和硬连接](F:\Users\tian\Pictures\linux图库\软链接和硬连接.png)

软链接文件的inode中，存放数据块指针的位置，存放的是一个路径，当源文件被删除时，软链接即失效，但是如果创建另外一个和该路劲同名的文件，那么这个软链接又将重新生效

硬连接，是直接指向数据块的，及时源文件被删除，还是可以通过硬连接访问！

说到这里，提一下我们的删除文件和移动文件，大家有没有发现，在平常生活中，我们删除文件和移动文件的速度是非常快的，其实它只是把inode清空了，源文件还是在硬盘上的，通过特定手段还是可以恢复的！ 而移动文件（在同一个文件系统中），本质上就是删除原有目录下的文件名和inode对应关系，再重新在另一个目录下创建一个新的对应关系！（也就是一个硬连接）

注意： 硬连接，是直接指向磁盘数据块的，所以，硬连接不能跨文件系统，还有，作用对象不能是目录（大概是为了防止互相硬连接倒置无限循环）

软链接是指向一个路径的，所以，它可以跨文件系统，也可以对目录进行链接

## 磁盘分区

* fdisk命令：交互式分区管理工具

  fdisk -l DEVICE 可以列出指定磁盘设备的分区情况

  执行fdisk DEVICE 会提供一个交互式接口，管理分区，有许多子命令，常用命令有

  > n	创建新分区
  >
  > d	删除已有分区
  >
  > t	修改分区类型
  >
  > l	产看所有分区id
  >
  > w	保存并退出
  >
  > q	不保存并退出
  >
  > m	查看帮助信息
  >
  > p	显示现有分区信息

  注意：在交互式模式中，所有操作均在内存中进行，直到使用w保存到磁盘上才生效！ q退出，修改即无效

* 

## 文件系统的挂载

在linux中，一个磁盘如果想要进行数据的存取，它首先要将其分区（非必要）并格式化为linux系统所支持的文件系统类型，然后关联到根下面的一个目录，被关联到的目录，称之为挂载点，而后，计算机就可以通过该目录（挂载点）对磁盘进行访问，存取数据

#### 挂载命令mount

语法：mount [-nrw] [-t vfstype] [-o options]  device dir

不加任何参数时，显示所有已经挂载的文件系统及相关信息

* 常用选项

  -n 默认情况下，设备挂载的操作会同步到/etc/mtab文件中，此选项，将禁用此特性

  -r 只读挂载

  -w 读写挂载

  -L 使用lable方式指明设备

  -U 使用UUID的方式指明设备

  -t 指明要挂载的文件系统类型，一般可省略

  -o，指明挂载选项

  > sync/nosync    同步/异步
  >
  > atime/noatime    访问文件或目录的同时，是否更行访问时间戳
  >
  > diratime/nodiratime        访问目录时，是否同步更新其访问时间
  >
  > remount            重新挂载
  >
  > acl     允许使用acl权限